var jGetEditorSelectedElement=!1,jGetEditorSelectedText=!1,jGetEditorSelectedImage=!1,jGetEditorSelectedLink=!1;(function(){function t(n){return encodeURIComponent(n).replace(/~/g,"%7E").replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function f(n,t){var i=n.getSelection();return element=i&&i.getSelectedElement()||null,element&&element.is(t)&&!element.isReadOnly()?element:!1}function o(n){return f(n,"audio")}function s(n){return f(n,"video")}function i(n){var t=n.getSelectedWidget()||null;return t?t.data.hasCaption||t.data.align=="center"?(t.parts.image.data("cke-align",t.data.align!="none"&&t.data.align||""),!t.data.hasCaption)?t.parts.image:t.element:(t.element.data("cke-align",t.data.align!="none"&&t.data.align||""),t.element):!1}function e(n,t){var r=[],i;if(t)for(i in t)r.push(i+"="+encodeURIComponent(t[i]));else return n;return n+(n.indexOf("?")!=-1?"&":"?")+r.join("&")}var r,n,u;jGetEditorSelectedAudio=function(n){var t=CKEDITOR.instances[n];return t?(element=o(t))?element.$:!1:!1};jGetEditorSelectedVideo=function(n){var t=CKEDITOR.instances[n];return t?(element=s(t))?element.$:!1:!1};jGetEditorSelectedImage=function(n){var t=CKEDITOR.instances[n];return t?(element=i(t))?element.$:!1:!1};r=function(n){var t=n.getSelectedWidget()||null;return t&&(t.inline?!t.wrapper.getAscendant("a"):1)?t.parts.link:CKEDITOR.plugins.link.getSelectedLink(n)||!1};jGetEditorSelectedLink=function(n){var t=CKEDITOR.instances[n];return t?(element=r(t))?element.$:!1:!1};jGetEditorSelectedElement=function(n){var t=CKEDITOR.instances[n];return t?(element=CKEDITOR.plugins.link.getSelectedLink(t))?element.$:(element=i(t))?element.$:!1:!1};jGetEditorSelectedText=function(n){var t=CKEDITOR.instances[n];return t?t.getSelection().getSelectedText():!1};n="arkimage2";u=/(?:[^\/])\/(([^\u0000-\u007F]|[\w-])+\.(?!(?:htm|php|asp|jsp|cfm|pl|cgi))\w+)$/;CKEDITOR.plugins.add("arkmedia",{requires:"image,document",icons:"image",hidpi:!0,init:function(f){var h,s,o,c;if(f.config.arkMediaEnabled){CKEDITOR.plugins.link.getSelectedLink2=r;imageManagerCmd={url:f.config.base+"index.php?option=com_arkmedia",exec:function(n){var c=n.config.filebrowserImageWindowWidth||n.config.filebrowserWindowWidth||"100%",l=n.config.filebrowserImageWindowHeight||n.config.filebrowserWindowHeight||(CKEDITOR.env.gecko?"92%":"100%"),r={stack:"images",stacklock:1},u,o,f,s,h;r.stacks="images";r.tmpl="component";r.editor="CKEDITOR";r.editorname=n.name;r.langCode||(r.language=n.langCode);r.edit=0;u=i(n);u&&(u.is("figure")?(f=u.findOne("img"),o=f.getAttribute("src").replace(n.config.base,""),r.edit=t(o)):(f=u.is("a")?u.findOne("img"):u,o=f.getAttribute("src").replace(n.config.base,""),r.edit=t(o)));s=e(this.url,r);h=function(n){n.cancel()};n.editable().once("blur",h,null,null,-100);n.popup(s,c,l)}};h={url:f.config.base+"index.php?option=com_arkmedia",exec:function(n){var s=n.config.filebrowserWindowWidth||"80%",h=n.config.filebrowserWindowHeight||(CKEDITOR.env.gecko?"77%":"85%"),i={},r=0,u=CKEDITOR.plugins.link.getSelectedLink2(n),i={stacklock:1,stack:"documents",stacks:"documents"},f,o;u&&(r=t(u.getAttribute("href").replace(n.config.base,"")));i.tmpl="component";i.editor="CKEDITOR";i.editorname=n.name;i.edit=r;i.langCode||(i.language=n.langCode);f=e(this.url,i);o=function(n){n.cancel()};n.editable().once("blur",o,null,null,-100);n.popup(f,s,h)}};s=f.addCommand(n,imageManagerCmd);s.modes={wysiwyg:1};f.widgets.onWidget("image","ready",function(){this.on("doubleclick",function(){return f.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(f.widgets.selectedWidget=this),f.execCommand(n),!1},null,null,4)});o="arkmedia2";c=f.addCommand(o,h);s.modes={wysiwyg:1};f.ui.addButton&&f.ui.addButton("Document",{label:f.lang.document.toolbar,command:o});f.on("doubleclick",function(n){var t=CKEDITOR.plugins.link.getSelectedLink2(f)||n.data.element;if(!t.isReadOnly())if(t.is("a")){if(t.getAttribute("name")||!t.getAttribute("href")&&t.getChildCount())t.getAttribute("name")&&(!t.getAttribute("href")||t.getChildCount())&&(n.data.dialog="anchor");else if(u.test(t.getAttribute("href")))return setTimeout(function(){f.execCommand(o)},0),!1}else CKEDITOR.plugins.link.tryRestoreFakeAnchor(f,t)&&(n.data.dialog="anchor")},null,null,4);f.removeMenuItem&&f.removeMenuItem("document");f.addMenuItems&&f.addMenuItems({document:{label:f.lang.document.menu,command:o,group:"link",order:1}})}},afterInit:function(t){if(t.config.arkMediaEnabled){t.removeMenuItem&&t.removeMenuItem("image");t.addMenuItems&&t.addMenuItems({image:{label:t.lang.image.menu,command:n,group:"image"}});t.ui.addButton&&t.ui.addButton("Image",{label:t.lang.common.image,command:n});t.on("blur",function(){t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(t.widgets.selectedWidget=null)});t.widgets.on("instanceCreated",function(n){var t=n.data;if(t.inline)t.on("contextMenu",function(n){n.data.image=CKEDITOR.TRISTATE_OFF;var t=this.parts.link||this.wrapper.getAscendant("a");t&&u.test(t.getAttribute("href"))&&(n.data.document=CKEDITOR.TRISTATE_OFF)})})}}})})()