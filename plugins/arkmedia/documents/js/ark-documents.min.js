!function(t){var e=function(t){this.initialise(t)};e.prototype=t.extend({},t.fn.arkbase(),{constructor:e,options:{css:{icon:"file4"},stack:"documents",allowempty:!0,support:[{ext:"swf",mime:"application/x-shockwave-flash",browsers:[]},{ext:"pdf",mime:"application/pdf",browsers:["mozilla"]},{ext:"txt",mime:"text/plain",browsers:["mozilla","msie"]},{ext:"xml",mime:"text/xml",browsers:["mozilla"]},{ext:"html",mime:"text/html",browsers:["mozilla","msie"]}]},initialise:function(t){this.set(t),this.requests()},requests:function(){t(document).on("edit:request:attributes",t.proxy(function(e,i){if(i.stack===this.options.stack){var o=t(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options});return o?t.fn.attribs(o):{}}},this)),t(document).on("edit:request:element",t.proxy(function(e,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var o=t.fn.callable("jGetEditorSelectedLink");return o?o.jGetEditorSelectedLink(i.options.field):!1}},this)),t(document).on("edit:request:html",t.proxy(function(e,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var o=t.fn.callable("jGetEditorSelectedImage");return o?o.jGetEditorSelectedImage(i.options.field):!1}},this)),t(document).on("edit:request:text",t.proxy(function(e,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var o=t.fn.callable("jGetEditorSelectedText");return o?o.jGetEditorSelectedText(i.options.field):!1}},this)),t(document).on("edit:request:preview:html",t.proxy(function(e,i){if(i.stack===this.options.stack&&i.path){var o=this.browser("browser"),s=this.extension(i.path),n="";if(t.each(this.options.support,function(e,i){return i.ext===s&&-1!==t.inArray(o,i.browsers)?(n=i.mime,!1):void 0}),n){var r="jQuery( document ).triggerHandler( 'edit:request:preview:open' )";return t("<object>",{type:n,onload:r}).attr("data",i.path).get(0).outerHTML}}},this)),t(document).on("edit:request:icon",t.proxy(function(t,e){return e.stack===this.options.stack?this.options.css.icon:void 0},this)),t(document).on("edit:request:build",t.proxy(function(e,i){if(i.stack===this.options.stack){var o=t(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options}),s=t(document).triggerHandler("edit:request:html",{stack:i.stack,options:i.options}),n=t(document).triggerHandler("edit:request:text",{stack:i.stack,options:i.options}),r=o||s||n;if("object"==typeof i.attributes){var a=t("<a>");return i.attributes.href=i.path||i.attributes.href,t.each(i.attributes,t.proxy(function(t,e){(this.options.allowempty||!this.options.allowempty&&e)&&a.attr(t,e)},this)),"object"==typeof r?"A"===t(r).prop("tagName")?a.html(t(r).html()):a.html(t(r)):"string"==typeof r&&r?a.html(r):i.path&&a.html(i.path),a.get(0).outerHTML}}},this))}}),t.fn.arkstackdocuments=function(t){return new e(t)}}(window.jQuery);