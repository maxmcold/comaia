!function(t){var e=function(t){this.initialise(t)};e.prototype=t.extend({},t.fn.arkbase(),{constructor:e,options:{stack:"images",suffix:null,allowempty:!0},initialise:function(t){this.set(t),this.requests()},requests:function(){t(document).on("edit:request:attributes",t.proxy(function(e,i){if(i.stack===this.options.stack){var a=t(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options}),s={};if(a){var n=this.getImage(a);s=t.fn.attribs(n.get(0)),s=this.caption(a,s),s=this.align(n,s)}return s}},this)),t(document).on("edit:request:element",t.proxy(function(e,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var a=t.fn.callable("jGetEditorSelectedImage");return a?a.jGetEditorSelectedImage(i.options.field):!1}},this)),t(document).on("edit:request:preview:html",t.proxy(function(e,i){return i.stack===this.options.stack&&i.path?t("<img>",{src:this.namespace(i.path,i.namespace||""),title:i.name,alt:i.name}).get(0).outerHTML:void 0},this)),t(document).on("edit:request:build",t.proxy(function(e,i){if(i.stack===this.options.stack&&"object"==typeof i.attributes){var a=t("<img>"),s=n=null;if(i.attributes.src=this.namespace(i.path||i.attributes.src,i.namespace||""),i.attributes.caption_title){var s=t("<figure>"),n=t("<figcaption>").text(i.attributes.caption_title);i.attributes.caption_class&&n.addClass(i.attributes.caption_class),s.append(a).append(n)}return i.attributes["data-cke-align"]&&(i.attributes.caption_title?s.addClass(i.attributes["data-cke-align"]):i.attributes["class"]=i.attributes["class"]+(i.attributes["class"]?" ":"")+i.attributes["data-cke-align"]),delete i.attributes["data-cke-align"],delete i.attributes.caption_title,delete i.attributes.caption_class,t.each(i.attributes,t.proxy(function(t,e){(this.options.allowempty||!this.options.allowempty&&e)&&a.attr(t,e)},this)),s?s.get(0).outerHTML:a.get(0).outerHTML}},this))},namespace:function(t,e){switch(!e&&this.options.suffix&&(e=this.options.suffix),e){case"timestamp":var i="t="+(new Date).getTime();break;case"id":var i="i="+this.id({length:3,special:"",alpha:""});break;case"none":var i=""}return t&&i?t+"?"+i:t},getImage:function(e){return this.isCaption(e)?t(e).find("img"):t(e)},isCaption:function(t){return"figure"===t.nodeName.toLowerCase()},caption:function(e,i){if(!this.isCaption(e))return i;var a=t(e).find("figcaption");return i.caption_title=a.text(),i.caption_class=a.attr("class"),i},align:function(t,e){var i=t.attr("data-cke-align");switch(i){case"none":e["data-cke-align"]="";break;case"left":case"right":case"center":e["data-cke-align"]="pull-"+i}return e}}),t.fn.arkstackimages=function(t){return new e(t)}}(window.jQuery);